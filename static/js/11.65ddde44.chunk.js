(this["webpackJsonpall-in-one"]=this["webpackJsonpall-in-one"]||[]).push([[11,13],{1140:function(e,t,n){"use strict";n.r(t);var a={};n.r(a),n.d(a,"updateStatus",(function(){return d})),n.d(a,"updateAuthStatus",(function(){return p}));var r=n(3),i=n.n(r),o=n(7),s=n(8),c=n(35),u=n(1145),l=n(139),h=n(235),d=function(e){return function(t){t({type:h.a.SET_WEBSOCKET_STATUS,payload:{status:e}})}},p=function(e){return function(t){t({type:h.a.SET_AUTH_STATUS,payload:{isAuthenticated:e}})}};n.d(t,"webSocket",(function(){return v}));var v=new(function(){function e(){Object(o.a)(this,e),this.socket=void 0,this.actions=void 0,this.handlers=[],this.socket=Object(u.a)("".concat(window.location.host),{path:"/io",transports:["websocket"],autoConnect:!1}),this.actions=Object(c.b)(a,l.a.dispatch),this.actions.updateStatus(h.b.ENABLED)}return Object(s.a)(e,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"".concat(window.location.host);this.socket.connected||(this.socket.io.uri=e,this.initListeners(),this.socket.connect())}},{key:"initListeners",value:function(){var e=this;this.socket.on("connect",(function(){return i.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:e.actions.updateStatus(h.b.CONNECTED);case 1:case"end":return t.stop()}}))})),this.socket.on("disconnect",(function(){e.actions.updateStatus(h.b.DISCONNECTED)})),this.socket.on("connect_error",(function(t){e.actions.updateStatus(h.b.CONNECTION_ERROR)})),this.socket.on("reconnect_error",(function(t){e.actions.updateStatus(h.b.CONNECTION_ERROR)})),this.socket.on("reconnect_failed",(function(t){e.actions.updateStatus(h.b.CONNECTION_ERROR)})),this.socket.on("SOCKET_INIT_STATUS",(function(t){e.actions.updateAuthStatus("success"===t.status)}))}},{key:"setSocketEventListeners",value:function(e){var t=this;e.forEach((function(e){t.handlers.push(e),t.socket.on(e.name,e.instance)}))}},{key:"disconnect",value:function(){this.removeSocketEventListeners(),this.socket.close()}},{key:"removeSocketEventListeners",value:function(){var e=this;this.handlers.forEach((function(t){e.socket.off(t.name,t.instance)}))}}]),e}())},1159:function(e,t,n){"use strict";n.r(t);var a=n(12),r=n(3),i=n.n(r),o=n(7),s=n(8),c=n(73),u=n(21),l=n(156),h=n(139),d=n(49),p=n(98),v=n(105),w=n(210),m=n(10),b=n(1140),f=n(27),k=n(35),T=Object(k.b)(w,h.a.dispatch),y=function(){function e(){var t=this;Object(o.a)(this,e),this.token="",this.courseId="",this.reviewApiUrl="",this.authServiceUrl="",this.authoringToolDomain="",this.initToken=function(){return i.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.a.awrap(t.getReviewTokenFromAuthService());case 2:e.sent||t.requestTokenFromParentWindow();case 4:case"end":return e.stop()}}))},this.getUserDetails=function(){return Object(f.h)(h.a.getState())},this.reviewTokenListener=function(e){return i.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:if((/\.easygenerator\.com$/.test(e.origin)||e.origin===window.location.origin)&&e.data.reviewToken){n.next=2;break}return n.abrupt("return");case 2:return document.cookie="".concat(l.q,"=").concat(e.data.reviewToken,";domain=easygenerator.com; Path=/"),n.next=5,i.a.awrap(t.getReviewTokenFromAuthService());case 5:window.removeEventListener("message",t.reviewTokenListener);case 6:case"end":return n.stop()}}))},this.requestTokenFromParentWindow=function(){window.addEventListener("message",t.reviewTokenListener);var e="https://".concat(t.authoringToolDomain,"/review/course").concat(window.location.pathname);window.location.href.includes(".easygenerator.com/")&&window.parent.postMessage({sendReviewToken:!0},e)}}return Object(s.a)(e,[{key:"initialize",value:function(e){var t,n,a,r;return i.a.async((function(o){for(;;)switch(o.prev=o.next){case 0:return t=e.reviewApiUrl,n=e.authServiceUrl,a=e.courseId,r=e.authoringToolDomain,this.reviewApiUrl=t,this.authServiceUrl=n,this.courseId=a,this.authoringToolDomain=r,o.next=7,i.a.awrap(this.initToken());case 7:case"end":return o.stop()}}),null,this)}},{key:"getReviewTokenFromAuthService",value:function(){var e,t;return i.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,i.a.awrap(c.b.get("".concat(this.authServiceUrl,"/api/account/token"),{credentials:"include",query:{clientId:l.m},retryOptions:{retries:0,retryOn:[503]}}));case 2:if(!((e=n.sent).status<400||window.location.href.includes("localhost")&&localStorage.getItem(l.q))){n.next=14;break}return n.next=6,i.a.awrap(e.json());case 6:return t=n.sent,this.token=null===t||void 0===t?void 0:t.token,n.next=10,i.a.awrap(this.getUserInfoFromToken());case 10:if(n.sent!==l.r){n.next=14;break}return m.a.emit(m.b.COMMENTS_LIST),n.abrupt("return",!0);case 14:return n.abrupt("return",!1);case 15:case"end":return n.stop()}}),null,this)}},{key:"endSession",value:function(){return i.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:if(window.navigator.onLine){e.next=3;break}return e.abrupt("return",l.h);case 3:return e.next=5,i.a.awrap(c.b.post("".concat(this.authServiceUrl,"/api/account/logout"),{credentials:"include"}));case 5:return h.a.dispatch({type:p.a.COMMENTS_LIST,payload:{comments:[]}}),e.next=8,i.a.awrap(T.logout());case 8:return h.a.dispatch({type:d.a.UPDATE_REVIEW_LAYOUT,payload:{layout:l.g.LOGIN_WITH_EMAIL}}),b.webSocket.disconnect(),e.abrupt("return",l.r);case 11:case"end":return e.stop()}}),null,this)}},{key:"getCallbackUrl",value:function(){var e=window.location.pathname;return"https://".concat(this.authoringToolDomain,"/review/course").concat(e)}},{key:"updateUserEmail",value:function(e){var t,n,a;return i.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:if(t=e.name,n=e.email,a=this.getCallbackUrl(),window.navigator.onLine){r.next=5;break}return r.abrupt("return",l.h);case 5:return r.next=7,i.a.awrap(c.b.put("".concat(this.authServiceUrl,"/api/account/login-link"),{headers:{"Content-Type":u.e.JSON},query:{clientId:l.m},data:{email:n,fullName:t,callbackUrl:a}}));case 7:if(200===r.sent.status){r.next=10;break}return r.abrupt("return",l.h);case 10:return h.a.dispatch({type:v.a.USER_AUTHENTICATED,payload:{name:t,email:n.newEmail}}),r.abrupt("return",l.r);case 12:case"end":return r.stop()}}),null,this)}},{key:"getLoginLink",value:function(e){var t,n,a,r,o,s;return i.a.async((function(d){for(;;)switch(d.prev=d.next){case 0:if(t=e.name,n=e.email,a=e.avatarUrl,r=e.isIdentified,o=window.navigator.onLine,s=this.getCallbackUrl(),o){d.next=5;break}return d.abrupt("return",l.h);case 5:return d.next=7,i.a.awrap(c.b.post("".concat(this.authServiceUrl,"/api/account/login-link"),{headers:{"Content-Type":u.e.JSON},query:{clientId:l.m},data:{email:n,fullName:t,callbackUrl:s}}));case 7:if(200===d.sent.status){d.next=10;break}return d.abrupt("return",l.h);case 10:return h.a.dispatch({type:v.a.USER_AUTHENTICATED,payload:{name:t,email:n,avatarUrl:a,isRegisteredReviewer:r}}),d.abrupt("return",l.r);case 12:case"end":return d.stop()}}),null,this)}},{key:"getUserInfoFromToken",value:function(){var e,t,n,r,o,s,p,w,m,f,k,T,y;return i.a.async((function(g){for(;;)switch(g.prev=g.next){case 0:if(window.navigator.onLine){g.next=3;break}return g.abrupt("return",l.t);case 3:return g.next=5,i.a.awrap(c.b.get("".concat(this.reviewApiUrl,"reviewers"),{headers:(e={"Content-Type":u.e.JSON},Object(a.a)(e,l.e,this.courseId),Object(a.a)(e,"X-Authoring-Tool-Domain",this.authoringToolDomain),Object(a.a)(e,"Authorization","Bearer ".concat(this.token)),e)}));case 5:if(404!==(t=g.sent).status||window.location.href.includes("localhost")){g.next=8;break}return g.abrupt("return",l.i);case 8:if(200===t.status||window.location.href.includes("localhost")){g.next=10;break}return g.abrupt("return",l.t);case 10:return g.next=12,i.a.awrap(t.json());case 12:return n=g.sent,r=n.fullName,o=n.email,s=n.avatarUrl,p=void 0===s?"":s,window.location.href.includes("localhost")&&(this.token=null!==(w=null!==(m=this.token)&&void 0!==m?m:localStorage.getItem(l.q))&&void 0!==w?w:"",r=null!==(f=null!==(k=r)&&void 0!==k?k:localStorage.getItem("reviewerUsername"))&&void 0!==f?f:"",o=null!==(T=null!==(y=o)&&void 0!==y?y:localStorage.getItem("reviewerUsermail"))&&void 0!==T?T:""),b.webSocket.init(this.reviewApiUrl),h.a.dispatch({type:v.a.USER_AUTHENTICATED,payload:{name:r,email:o,avatarUrl:p,isAuthenticatedReviewer:!0}}),h.a.dispatch({type:d.a.UPDATE_REVIEW_LAYOUT,payload:{layout:l.g.ADD_COMMENT_WITH_HISTORY}}),g.abrupt("return",l.r);case 22:case"end":return g.stop()}}),null,this)}},{key:"deleteCommentRequest",value:function(e){var t,n,r,o,s;return i.a.async((function(u){for(;;)switch(u.prev=u.next){case 0:if(n=e.commentId,r=window.navigator.onLine,o=this.getUserDetails(),s=o.name,r){u.next=5;break}return u.abrupt("return",l.c);case 5:return u.next=7,i.a.awrap(c.b.delete("".concat(this.reviewApiUrl,"comments/").concat(n),{headers:(t={},Object(a.a)(t,l.e,this.courseId),Object(a.a)(t,"X-Authoring-Tool-Domain",this.authoringToolDomain),Object(a.a)(t,"Authorization","Bearer ".concat(this.token)),t),query:{fullName:s,isReviewer:!0}}));case 7:if(200===u.sent.status){u.next=10;break}return u.abrupt("return",l.c);case 10:return u.abrupt("return",l.r);case 11:case"end":return u.stop()}}),null,this)}},{key:"deleteReplyRequest",value:function(e){var t,n,r,o,s,u;return i.a.async((function(h){for(;;)switch(h.prev=h.next){case 0:if(n=e.commentId,r=e.replyId,o=window.navigator.onLine,s=this.getUserDetails(),u=s.name,o){h.next=5;break}return h.abrupt("return",l.j);case 5:return h.next=7,i.a.awrap(c.b.delete("".concat(this.reviewApiUrl,"comments/").concat(n,"/replies/").concat(r),{headers:(t={},Object(a.a)(t,l.e,this.courseId),Object(a.a)(t,"X-Authoring-Tool-Domain",this.authoringToolDomain),Object(a.a)(t,"Authorization","Bearer ".concat(this.token)),t),query:{fullName:u,isReviewer:!0}}));case 7:if(200===h.sent.status){h.next=10;break}return h.abrupt("return",l.j);case 10:return h.abrupt("return",l.r);case 11:case"end":return h.stop()}}),null,this)}},{key:"ackDeletedRequest",value:function(e){var t,n,r,o,s;return i.a.async((function(h){for(;;)switch(h.prev=h.next){case 0:if(n=e.commentId,r=e.replyId,o=window.navigator.onLine,s="",o){h.next=5;break}return h.abrupt("return",l.a);case 5:return r&&(s="replies/".concat(r,"/")),h.next=8,i.a.awrap(c.b.post("".concat(this.reviewApiUrl,"comments/").concat(n,"/").concat(s,"acknowledge/delete"),{headers:(t={"Content-Type":u.e.JSON},Object(a.a)(t,l.e,this.courseId),Object(a.a)(t,"X-Authoring-Tool-Domain",this.authoringToolDomain),Object(a.a)(t,"Authorization","Bearer ".concat(this.token)),t),data:{}}));case 8:if(200===h.sent.status){h.next=11;break}return h.abrupt("return",l.a);case 11:return h.abrupt("return",l.r);case 12:case"end":return h.stop()}}),null,this)}},{key:"ackResolvedRequest",value:function(e){var t,n;return i.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.commentId,window.navigator.onLine){r.next=4;break}return r.abrupt("return",l.a);case 4:return r.next=6,i.a.awrap(c.b.post("".concat(this.reviewApiUrl,"comments/").concat(n,"/acknowledge/resolve"),{headers:(t={"Content-Type":u.e.JSON},Object(a.a)(t,l.e,this.courseId),Object(a.a)(t,"X-Authoring-Tool-Domain",this.authoringToolDomain),Object(a.a)(t,"Authorization","Bearer ".concat(this.token)),t),data:{}}));case 6:if(200===r.sent.status){r.next=9;break}return r.abrupt("return",l.a);case 9:return r.abrupt("return",l.r);case 10:case"end":return r.stop()}}),null,this)}},{key:"sendCommentReplyRequest",value:function(e){var t,n,r,o,s,h,d,p,v;return i.a.async((function(w){for(;;)switch(w.prev=w.next){case 0:if(r=e.commentId,o=e.data,s=window.navigator.onLine,h=this.getUserDetails(),d=h.name,p=h.email,v=h.avatarUrl,s){w.next=5;break}return w.abrupt("return",l.k);case 5:return o.createdBy={avatarUrl:v,email:p,firstName:(null===d||void 0===d?void 0:null===(t=d.split(" "))||void 0===t?void 0:t[0])||"",lastName:(null===d||void 0===d?void 0:d.split(" ").splice(1).join(" "))||"",fullName:d||"",isReviewer:!0},w.next=8,i.a.awrap(c.b.post("".concat(this.reviewApiUrl,"comments/").concat(r,"/replies"),{headers:(n={"Content-Type":u.e.JSON},Object(a.a)(n,l.e,this.courseId),Object(a.a)(n,"X-Authoring-Tool-Domain",this.authoringToolDomain),Object(a.a)(n,"Authorization","Bearer ".concat(this.token)),n),data:o}));case 8:if(201===w.sent.status){w.next=11;break}return w.abrupt("return",l.k);case 11:return w.abrupt("return",l.r);case 12:case"end":return w.stop()}}),null,this)}},{key:"sendCommentRequest",value:function(e){var t,n,a,r,o,s,d,v;return i.a.async((function(w){for(;;)switch(w.prev=w.next){case 0:if(t=e.data,n=window.navigator.onLine,a=this.getUserDetails(),r=a.name,o=a.email,n){w.next=5;break}return w.abrupt("return",l.d);case 5:return t.createdByName=r,t.fullName=r,t.createdBy=o,t.courseId=this.courseId,w.next=11,i.a.awrap(c.b.post("".concat(this.reviewApiUrl,"comments"),{headers:{"Content-Type":u.e.JSON,"X-Authoring-Tool-Domain":this.authoringToolDomain},data:t}));case 11:if(200===(s=w.sent).status){w.next=14;break}return w.abrupt("return",l.d);case 14:return w.next=16,i.a.awrap(s.json());case 16:return d=w.sent,v={id:d.id,text:t.text,mentionedEmails:[],deletedSeenEmails:[],resolvedSeenEmails:[],context:t.context,courseId:this.courseId,createdOn:new Date,createdBy:{fullName:r,email:o,isReviewer:!0},replies:[],isDeleted:!1,isResolved:!1},h.a.dispatch({type:p.a.COMMENT_ADDED,payload:{comment:v}}),w.abrupt("return",l.r);case 20:case"end":return w.stop()}}),null,this)}},{key:"getCommentsRequest",value:function(){var e,t,n;return i.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:if(window.navigator.onLine){r.next=3;break}return r.abrupt("return",l.b);case 3:return r.next=5,i.a.awrap(c.b.get("".concat(this.reviewApiUrl,"comments/by-reviewer"),{headers:(e={"Content-Type":u.e.JSON},Object(a.a)(e,l.e,this.courseId),Object(a.a)(e,"X-Authoring-Tool-Domain",this.authoringToolDomain),Object(a.a)(e,"Authorization","Bearer ".concat(this.token)),e)}));case 5:if(200===(t=r.sent).status){r.next=8;break}return r.abrupt("return",l.b);case 8:return r.next=10,i.a.awrap(t.json());case 10:return n=r.sent,h.a.dispatch({type:p.a.COMMENTS_LIST,payload:{comments:n}}),r.abrupt("return",l.r);case 13:case"end":return r.stop()}}),null,this)}}]),e}();t.default=new y}}]);