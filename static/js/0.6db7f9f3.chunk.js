(this["webpackJsonpall-in-one"]=this["webpackJsonpall-in-one"]||[]).push([[0],{1206:function(e,t,n){"use strict";n.r(t);var i=n(7),r=n(8),s=n(121),a=n.n(s),o=n(302),c=n(14),u=n(11),d=n(13),l=n(10),p=n(3),h=n.n(p),f=n(181),v=n(81),m=n.n(v),b=n(43),S=n(52),O=n(12),x=n(157),j=n(420),y=n(47),E=n(18),g=n(102),L=function(e){var t=e.section,n=e.xapiStatus,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return{verb:Object(g.d)(n)?x.i.progressed:x.i.mastered,object:Object(j.c)(t,i),result:Object(j.b)({score:t.score})}},w=n(5),k=n(122),P=function(e){var t=e.question;return{response:t.answers.filter((function(e){return t.response.indexOf(e.id)>=0})).map((function(e){return e.id})).join(x.h.comma),correctResponsesPattern:t.type===E.k?t.correctAnswerId:t.answers.filter((function(e){return e.isCorrect})).map((function(e){return e.id})).join(x.h.comma),interactionType:x.f.choice,extraActivityDefinition:{choices:t.answers.map((function(e){return{id:e.id,description:{"en-US":t.type===E.k||t.type===E.f?e.image:e.text}}}))}}},A=n(213),H=function(e){var t=e.question,n=e.questionContent,i=t.response,r=t.answerGroups,s=i.data,a=void 0===s?function(e){return e.reduce((function(e,t){var n=t.id;return Object(w.a)(Object(O.a)({},n,""),e)}),{})}(r):s,o=Object.keys(a).map((function(e){return"".concat(a[e]).concat(x.h.dot).concat(e)})).join(x.h.comma),c=r.map((function(e){return e.answers.filter((function(e){return e.isCorrect})).map((function(t){return"".concat(t.text).concat(x.h.dot).concat(e.id)})).join(x.h.comma)})).join(x.h.comma),u=Object(S.a)(n,1)[0],d=void 0===u?{value:""}:u;return{response:o,correctResponsesPattern:c,interactionType:x.f.fillIn,extensions:Object(O.a)({},x.d.content,Object(A.d)(d.value))}},C=function(e){return{response:e.question.response.answeredText,omitScore:!0,interactionType:x.f.other}},R=function(e){var t=e.question;return{response:t.response.map((function(e){return"".concat(e.id).concat(x.h.dot).concat(e.isCorrect)})).join(x.h.comma),correctResponsesPattern:t.answers.map((function(e){return"".concat(e.id).concat(x.h.dot).concat(e.isCorrect)})).join(x.h.comma),interactionType:x.f.choice,extraActivityDefinition:{choices:t.answers.map((function(e){return{id:e.id,description:{"en-US":e.text}}}))}}},T=function(e){var t=e.question,n=e.isXapiPackageMode;return{response:t.response.map((function(e){return e.id})).join(x.h.comma),correctResponsesPattern:t.answers.map((function(e){return e.id})).join(x.h.comma),interactionType:n?x.f.sequencing:x.f.choice,extraActivityDefinition:{choices:t.answers.map((function(e){return{id:e.id,description:{"en-US":e.text}}}))}}},N=function(e){var t=e.question,n=function(e){return e.map((function(e,t){return{id:t.toString(),description:{"en-US":e}}}))},i=t.answers.map((function(e){return e.key})),r=t.answers.map((function(e){return e.value})).filter((function(e,t,n){return n.indexOf(e)===t})),s=t.answers.map((function(e){return"".concat(i.indexOf(e.key)).concat(x.h.dot).concat(r.indexOf(e.value))})).join(x.h.comma);return{response:i.map((function(e,n){var i=t.response.find((function(t){return t.key===e})),s="";return i&&i.shownSelectedValue&&(s=r.indexOf(i.shownSelectedValue)),"".concat(n).concat(x.h.dot).concat(s)})).join(x.h.comma),correctResponsesPattern:s,interactionType:x.f.matching,extraActivityDefinition:{source:n(i),target:n(r)}}},U=function(){return{interactionType:x.f.other}},_=function(e){var t,n=e.question,i=n.dropspots.map((function(e){return e.text})).join(x.h.comma),r=n.dropspots.map((function(e){return"(".concat(e.x,",").concat(e.y,")")})).join(x.h.comma);return{response:n.dropspots.map((function(e){var t=n.response.find((function(t){return t.id===e.id}));if(!t)return"(-1,-1)";var i=t.items.length&&t.items[0];if(!i)return"(-1,-1)";var r=n.dropspots.find((function(e){return e.id===i.id}));return"(".concat(r.x,",").concat(r.y,")")})).join(x.h.comma),correctResponsesPattern:r,interactionType:x.f.other,extensions:(t={},Object(O.a)(t,x.d.imageUrl,n.background),Object(O.a)(t,x.d.answerTexts,i),t)}},I=function(e){var t=e.question;return{response:t.response.map((function(e){return"(".concat(e.x,",").concat(e.y,")")})).join(x.h.comma),correctResponsesPattern:t.spots.map((function(e){return e.map((function(e){return"(".concat(e.x,",").concat(e.y,")")})).join(x.h.dot)})).join(x.h.comma),interactionType:x.f.other,extensions:Object(O.a)({},x.d.imageUrl,t.background)}},z=function(e,t){var n=Object(S.a)(e,3),i=n[0],r=n[1],s=n[2];return D(i,r,t,function(e){switch(e.type){case E.j:case E.e:case E.k:case E.f:return P;case E.b:return H;case E.g:return C;case E.l:return R;case E.h:return T;case E.m:return N;case E.i:return U;case E.a:return _;case E.c:return I;default:throw new Error("Question type ".concat(e.type," is not supported"))}}(i)({question:i,questionContent:s,isXapiPackageMode:t}))};function D(e,t,n,i){var r=i.response,s=i.correctResponsesPattern,a=i.interactionType,c=i.extraActivityDefinition,u=i.omitScore,d=i.extensions,l=i.verb,p=function(e,t,n){var i;return o.a.extendContext(new m.a.Context({contextActivities:new m.a.ContextActivities({parent:[Object(j.c)(t,n)]}),extensions:(i={},Object(O.a)(i,x.d.surveyMode,e.hasOwnProperty("isSurvey")&&e.isSurvey),Object(O.a)(i,x.d.questionType,e.type),i)}),n)}(e,t,n);p.extensions=Object.assign(p.extensions,d);var h=Object(w.a)({name:{"en-US":e.title},type:x.a.interaction,interactionType:a},s&&{correctResponsesPattern:e.isSurvey?[]:[s]});return h=Object.assign(h,c),{context:p,verb:l||x.i.answered,object:new m.a.Activity({id:Object(k.d)(t.id,e.id,n),definition:new m.a.ActivityDefinition(h)}),result:Object(j.b)({score:e.score,omitScore:u,response:r})}}var X,q=function(e,t){var n=Object(S.a)(e,2);return D(n[0],n[1],t,{interactionType:x.f.other,verb:x.i.experienced})},M=(X={},Object(O.a)(X,y.b.PASSED,x.i.passed),Object(O.a)(X,y.b.FAILED,x.i.failed),Object(O.a)(X,y.b.IN_PROGRESS,x.i.progressed),X),V=function(e,t){return(Object(S.a)(e,1)[0].type===E.d?q:z)(e,t)},F=function(e){return e&&x.i.hasOwnProperty(e)?{verb:x.i[e]}:{verb:x.i.started}},G=function(){return{verb:x.i.launched}},Q=function(e){return e&&x.i.hasOwnProperty(e)?{verb:x.i[e]}:{verb:x.i.completed}},B=function(e,t){var n=e.course,i=e.timeSpent,r=e.xapiStatus,s={score:n.score,duration:i};return r!==y.b.IN_PROGRESS&&t&&(s.completion=!0,s.success=r===y.b.PASSED),{verb:M[r],result:Object(j.b)(s)}},J=function(e){var t=e.statementsData,n=e.isSubmitOnce,i=void 0!==n&&n,r=e.isXapiPackageMode,s=void 0!==r&&r;if(!i)return t.map((function(e){var t=e.section,n=e.questionData,i=e.course;return[t?L(t,s):[],n?V(n,s):[],B(i,s)]})).flat(2);var a=Object(S.a)(t,3),o=a[0],c=a[1],u=a[2],d=o.map((function(e){return V(e,s)})),l=c.map((function(e){return L(e,s)})),p=B(u,s);return[].concat(Object(b.a)(d),Object(b.a)(l),[p])},W=function(e){var t=e.score,n=e.response;return{verb:x.i.evaluated,result:Object(j.b)({score:t,response:n})}},K=new function e(){var t=this;Object(i.a)(this,e),this.courseLaunched=void 0,this.courseStarted=void 0,this.informationContentExperienced=void 0,this.questionAnswered=void 0,this.overallCourseProgressed=void 0,this.courseCompleted=void 0,this.courseEvaluated=void 0,this.listStatement=void 0,this.listStatement=[{name:"courseLaunched",instance:G},{name:"courseStarted",instance:F},{name:"informationContentExperienced",instance:q},{name:"questionAnswered",instance:z},{name:"overallCourseProgressed",instance:J},{name:"courseCompleted",instance:Q},{name:"courseEvaluated",instance:W}],this.listStatement.forEach((function(e){t[e.name]=function(){var t=[e.instance.apply(e,arguments)].flat();return t.map((function(e){return new m.a.Statement(e)}))}}))},Y=function(e){console.error("xApi error: [ ".concat($(e)," ]"))};function Z(e){console.error("xApi error: [ ".concat($(e)," ]"))}function $(e){return e?e.code&&e.mesg?"code: ".concat(e.code,", message: ").concat(e.mesg):e.toString():"undefined error"}var ee=function(e){function t(e){var n,r=e.sendStatement,s=e.shouldHandlerErrors;return Object(i.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this))).handlers=void 0,n.sendStatement=void 0,n.shouldHandlerErrors=void 0,n.handlers=[],n.sendStatement=r,n.shouldHandlerErrors=s,n}return Object(d.a)(t,e),Object(r.a)(t,[{key:"createHandler",value:function(e){var t=this;return function(n){return h.a.async((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,h.a.awrap(t.handle(e,n));case 2:case"end":return i.stop()}}))}}},{key:"handle",value:function(e,t){var n;return h.a.async((function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,n=K[e](t),i.next=4,h.a.awrap(this.sendStatement(n));case 4:i.next=13;break;case 6:if(i.prev=6,i.t0=i.catch(0),!this.shouldHandlerErrors){i.next=12;break}Y(i.t0),i.next=13;break;case 12:throw i.t0;case 13:case"end":return i.stop()}}),null,this,[[0,6]])}}]),t}(f.a),te=n(73),ne=n(557),ie=n.n(ne),re=function(){function e(){Object(i.a)(this,e),this.statements=void 0,this.statements=[]}return Object(r.a)(e,[{key:"push",value:function(e){var t;(t=this.statements).push.apply(t,Object(b.a)([e].flat()))}},{key:"shift",value:function(){var e=this.statements;return this.statements=[],e}}]),e}(),se=!0,ae=new(function(){function e(){Object(i.a)(this,e),this.settings=void 0,this.promises=void 0,this.xapiLmsPromises=void 0,this.lrsStatementStorage=void 0,this.xapiLmsStatementsStorage=void 0}return Object(r.a)(e,[{key:"initialize",value:function(e){this.settings=e,this.promises=[],this.lrsStatementStorage=new re}},{key:"initializeXapiLms",value:function(){this.xapiLmsPromises=[],this.xapiLmsStatementsStorage=new re}},{key:"sendLrsStatements",value:function(e){var t=e;return o.a.isDefaultLrs(this.settings.xApi)||(t=this.getAllowedStatements(e,this.settings.xApi.allowedVerbs)).length?(this.lrsStatementStorage.push(t),this.sendStorageStatements(this.lrsStatementStorage,this.promises,o.a.lrs),Promise.all(this.promises)):null}},{key:"sendNpsStatement",value:function(e){this.doSend(o.a.nps.sendStatements.bind(o.a.nps),e)}},{key:"sendLxpStatement",value:function(e){this.doSend(o.a.lxp.sendStatements.bind(o.a.lxp),e)}},{key:"sendXapiLmsStatements",value:function(e){return this.xapiLmsStatementsStorage.push(e),this.sendStorageStatements(this.xapiLmsStatementsStorage,this.xapiLmsPromises,o.a.xapiLms),Promise.all(this.xapiLmsPromises)}},{key:"getAllowedStatements",value:function(e,t){return e.filter((function(e){return t.includes(e.verb.display["en-US"])}))}},{key:"sendStorageStatements",value:function(e,t,n){var i=this,r=e.shift();if(0!==r.length){var s=ie()(r,10).map((function(e){return i.doSend(n.sendStatements.bind(n),e)}));t.push(s)}}},{key:"doSend",value:function(e,t){var n=this;return new Promise((function(n,i){e(t,(function(e){if(e){var t=e.find((function(e){return null!==e.err}));t?i(t.err):(!se&&l.a.emit(l.b.APP_ONLINE),se=!0,n())}}))})).catch((function(){setTimeout((function(){se&&l.a.emit(l.b.APP_OFFLINE_OR_SERVER_ERROR),se=!1,n.doSend(e,t)}),te.a)}))}}]),e}()),oe=function(e){function t(){return Object(i.a)(this,t),Object(c.a)(this,Object(u.a)(t).call(this,{sendStatement:ae.sendLrsStatements.bind(ae),shouldHandlerErrors:!0}))}return Object(d.a)(t,e),Object(r.a)(t,[{key:"initialize",value:function(e){var t=e.isScoringOfContentPagesAllowed;this.handlers=[{event:l.b.COURSE_SUBMIT,instance:this.createHandler("overallCourseProgressed")},{event:l.b.COURSE_STARTED,instance:this.createHandler("courseLaunched")},{event:l.b.QUESTION_ANSWERED,instance:this.createHandler("overallCourseProgressed")}],t&&this.handlers.push({event:l.b.INFORMATION_CONTENT_EXPERIENCED,instance:this.createHandler("overallCourseProgressed")})}}]),t}(ee),ce=function(e){function t(){return Object(i.a)(this,t),Object(c.a)(this,Object(u.a)(t).call(this,{sendStatement:ae.sendNpsStatement.bind(ae)}))}return Object(d.a)(t,e),Object(r.a)(t,[{key:"initialize",value:function(){this.handlers=[{event:l.b.COURSE_EVALUATED,instance:this.createHandler("courseEvaluated")}]}}]),t}(ee),ue=function(e){function t(){return Object(i.a)(this,t),Object(c.a)(this,Object(u.a)(t).call(this,{sendStatement:ae.sendLxpStatement.bind(ae)}))}return Object(d.a)(t,e),Object(r.a)(t,[{key:"initialize",value:function(e){var t=this;this.handlers=Object.keys(e).map((function(e){if(x.c.hasOwnProperty(e)){var n=x.c[e],i=x.e[n];return{event:n,instance:t.createHandler(i)}}return null}))}}]),t}(ee),de=function(e){function t(){return Object(i.a)(this,t),Object(c.a)(this,Object(u.a)(t).call(this,{sendStatement:ae.sendXapiLmsStatements.bind(ae),shouldHandlerErrors:!0}))}return Object(d.a)(t,e),Object(r.a)(t,[{key:"initialize",value:function(e){var t=e.isScoringOfContentPagesAllowed;this.handlers=[{event:l.b.COURSE_SUBMIT_XAPI_LMS,instance:this.createHandler("overallCourseProgressed")},{event:l.b.COURSE_STARTED,instance:this.createHandler("courseLaunched")},{event:l.b.QUESTION_ANSWERED_XAPI_LMS,instance:this.createHandler("overallCourseProgressed")}],t&&this.handlers.push({event:l.b.INFORMATION_CONTENT_EXPERIENCED_XAPI_LMS,instance:this.createHandler("overallCourseProgressed")})}}]),t}(ee),le=function(){function e(){Object(i.a)(this,e),this.lrsEventHandler=void 0,this.npsEventHandler=void 0,this.lxpEventHandler=void 0,this.xapiLmsEventHandler=void 0,this.settings=void 0,this.defaultLrsUrl=void 0,this.defaultNpsUrl=void 0,this.defaultLxpUrl=void 0,this.lrsEventHandler=new oe,this.npsEventHandler=new ce,this.lxpEventHandler=new ue,this.xapiLmsEventHandler=new de}return Object(r.a)(e,[{key:"subscribeLrs",value:function(){try{o.a.initializeLrs(this.settings.xApi,this.defaultLrsUrl)}catch(e){this.unsubscribeLrs(),Y(e)}this.lrsEventHandler.on()}},{key:"subscribeNps",value:function(){try{o.a.initializeNps(this.defaultNpsUrl)}catch(e){this.unsubscribeNps(),Z(e)}this.npsEventHandler.on()}},{key:"subscribeLxp",value:function(e){try{o.a.initializeLxp(this.defaultLxpUrl,e)}catch(t){this.unsubscribeLxp(),Z(t)}this.lxpEventHandler.on()}},{key:"subscribeXapiLms",value:function(){try{o.a.initializeXapiLms()}catch(e){this.unsubscribeXapiLms(),Y(e)}this.xapiLmsEventHandler.on()}},{key:"unsubscribeLrs",value:function(){this.lrsEventHandler.off()}},{key:"unsubscribeNps",value:function(){this.npsEventHandler.off()}},{key:"unsubscribeLxp",value:function(){this.lxpEventHandler.off()}},{key:"unsubscribeXapiLms",value:function(){this.xapiLmsEventHandler.off()}},{key:"unsubscribeAll",value:function(){this.unsubscribeLrs(),this.unsubscribeNps(),this.unsubscribeLxp(),this.unsubscribeXapiLms()}},{key:"initializeXapiLms",value:function(e){var t=e.settings;this.xapiLmsEventHandler.initialize(t),ae.initializeXapiLms()}},{key:"initialize",value:function(e){var t,n=e.settings,i=e.defaultLrsUrl,r=e.defaultNpsUrl,s=e.defaultLxpUrl,c=e.course,u=e.actor;this.settings=n,this.defaultLrsUrl=i,this.defaultNpsUrl=r,this.defaultLxpUrl=s,this.lrsEventHandler.initialize(n),this.npsEventHandler.initialize(),a()(null===(t=n.lxp)||void 0===t?void 0:t.xApiVerbs)||this.lxpEventHandler.initialize(n.lxp.xApiVerbs),o.a.initialize({course:c,actor:u}),ae.initialize(n)}}]),e}();t.default=new le}}]);